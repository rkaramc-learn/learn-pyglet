# Asset Management Guide

This document details all game assets, their sources, generation strategies, and version control policies.

## Asset Inventory

| Asset           | Path                       | Type                   | Size    | Tracked | Source/Generation          | Status                                     |
| --------------- | -------------------------- | ---------------------- | ------- | ------- | -------------------------- | ------------------------------------------ |
| **kitten**      | `images/kitten.png`        | Sprite (PNG)           | 0.85 MB | ✅ Yes | Committed directly         | ✅ Checked in                             |
| **meow**        | `audio/sfx/meow.wav`       | SFX (WAV)              | 0.15 MB | ✅ Yes | Committed directly         | ✅ Checked in                             |
| **mouse_sheet** | `sprites/mouse_sheet.png`  | Sprite Sheet (PNG)     | 0.95 MB | ❌ No  | Generated from `mouse.mp4` | !!TODO Check in to repository!!            |
| **ambience**    | `audio/music/ambience.wav` | Background Music (WAV) | 8.5 MB  | ❌ No  | External source            | !!TODO Check in to repository with Git-LFS |
| **mouse.mp4**   | `source/mouse.mp4`         | Source Video (MP4)     | 1.2 MB  | ❌ No  | External source            | ⚠️ Ignored                             |

**Total Size:** 11.6 MB\
**Tracked:** 3 assets (1.0 MB)\
**Ignored:** 2 assets (10.6 MB)

## Asset Manifest

The authoritative source for asset metadata is `src/pyglet_readme/assets/manifest.yaml`, which documents:

- Asset paths and types
- Dimensions and scaling factors
- Format and sample rates
- Tracked vs. ignored status
- Description and usage

## Commit Strategy

### Tracked Assets (Committed to Repository)

These assets are small enough and essential enough to commit:

**kitten.png**

- PNG sprite (1040×1040 px, scaled to 104×104 in-game)
- **Why tracked:** Core game asset, small (\<1 MB)
- **Storage:** `src/pyglet_readme/assets/images/kitten.png`

**meow.wav**

- WAV sound effect (~0.5 seconds)
- **Why tracked:** Core game asset, small (\<1 MB), no external dependencies
- **Storage:** `src/pyglet_readme/assets/audio/sfx/meow.wav`

### Ignored Assets (Not in Repository)

These assets are excluded from version control to reduce repo size:

**mouse_sheet.png** (0.95 MB)

!!TODO: Check in to repository!!

- PNG sprite sheet (1000×1000 px, 10×10 grid)
- **Why ignored:** Generated from source video, can be recreated
- **Storage:** `src/pyglet_readme/assets/sprites/mouse_sheet.png`
- **Git Rule:** Listed in `.gitignore` line 17

**ambience.wav** (8.5 MB)

!!TODO: Configure Git-LFS and check in to repository!!

- WAV background music loop (~30 seconds)
- **Why ignored:** Large media file, external source
- **Storage:** `src/pyglet_readme/assets/audio/music/ambience.wav`
- **Git Rule:** Listed in `.gitignore` line 21

**mouse.mp4** (1.2 MB)

- MP4 source video for sprite generation
- **Why ignored:** Source asset, not for distribution
- **Storage:** `src/pyglet_readme/assets/source/mouse.mp4`
- **Git Rule:** Listed in `.gitignore` line 14

## Asset Generation Strategy

### mouse_sheet.png Generation

The sprite sheet is generated from the source video using FFmpeg and the `SpriteSheetGenerator` class.

**Tool:** `SpriteSheetGenerator` (`src/pyglet_readme/sprite_generator.py`)

**Requirements:**

- FFmpeg (for frame extraction)
- FFprobe (for video metadata)
- Python 3.13+

**Command:**

```bash
uv run python scripts/demo_debug_logging.py  # Or integrate into asset restoration
```

**Process:**

1. Reads video metadata from `mouse.mp4` (frame count, FPS)
1. Extracts frames to PNG images
1. Arranges into 10×10 grid (100 frames per sprite sheet)
1. Saves to `sprites/mouse_sheet.png`

**Configuration:**

```python
from pyglet_readme.sprite_generator import SpriteSheetGenerator

generator = SpriteSheetGenerator()
generator.generate(
    video_path="src/pyglet_readme/assets/source/mouse.mp4",
    output_dir="src/pyglet_readme/assets/sprites",
    grid_cols=10,
    grid_rows=10,
    frame_width=100,
    frame_height=100,
)
```

### ambience.wav Restoration

**Status:** ⚠️ Currently undocumented

The source and generation method for background music is not documented. Options:

1. **Download from external storage** (if hosted online)
1. **Generate using synthesis** (e.g., procedural audio generation)
1. **Provide sourcing instructions** (point users to Creative Commons sources)

**TODO:** Document the authoritative source for `ambience.wav`

### mouse.mp4 Sourcing

**Status:** ⚠️ Currently undocumented

The source for the mouse video sprite source is not documented.

**Options:**

1. **Store in external cloud storage** (AWS S3, GitHub Releases, etc.)
1. **Link to Creative Commons video source** (if applicable)
1. **Provide recording instructions** (if hand-captured)

**TODO:** Document where `mouse.mp4` originates and how to obtain it

## Asset Restoration for Fresh Clones

When cloning the repository, ignored assets must be restored to run the game with full functionality.

### Current Status

**Partially Automated:**

- ✅ `mouse_sheet.png` can be generated if `mouse.mp4` is present
- ❌ `ambience.wav` sourcing not automated
- ❌ `mouse.mp4` sourcing not automated

### TODO: Asset Restoration Script

Create an automated script to restore missing assets:

```bash
uv run python scripts/restore_assets.py
```

This script should:

1. **Check for ignored assets**

   ```python
   missing = check_missing_assets([
       "src/pyglet_readme/assets/sprites/mouse_sheet.png",
       "src/pyglet_readme/assets/audio/music/ambience.wav",
       "src/pyglet_readme/assets/source/mouse.mp4",
   ])
   ```

1. **For mouse_sheet.png:**

   - Check if `mouse.mp4` exists
   - If yes, run `SpriteSheetGenerator`
   - If no, prompt user to download/provide `mouse.mp4`

1. **For ambience.wav:**

   - Prompt user with sourcing options
   - Provide download link or generation instructions

1. **For mouse.mp4:**

   - Check if available locally
   - Provide download instructions from external source

1. **Report status**

   - List which assets were restored
   - List which still need manual action
   - Verify asset integrity (optional: checksum validation)

### Fallback Behavior

The game is designed to handle missing ignored assets gracefully:

- **mouse_sheet.png:** Falls back to solid-color rectangle
- **ambience.wav:** Background music simply doesn't play

See `hello_world.py` lines 69-79 and 117-124 for fallback implementations.

## Asset Directory Structure

```
src/pyglet_readme/assets/
├── images/
│   ├── .gitkeep
│   └── kitten.png          [TRACKED]
├── sprites/
│   ├── .gitkeep
│   └── mouse_sheet.png     [IGNORED - generated]
├── audio/
│   ├── sfx/
│   │   ├── .gitkeep
│   │   └── meow.wav        [TRACKED]
│   └── music/
│       ├── .gitkeep
│       └── ambience.wav    [IGNORED - external]
├── source/
│   ├── .gitkeep
│   └── mouse.mp4           [IGNORED - source]
└── manifest.yaml           [TRACKED - metadata]
```

## Size Constraints

To keep repository size manageable:

**Limit for tracked assets:** < 1 MB per file, < 2 MB total for new assets

**File size threshold for ignoring:** > 1 MB (see `.gitignore`)

**Total committed size target:** < 5 MB

Current committed size: **1.0 MB** ✅

## Verification

### Verify Manifest

Check that manifest matches actual assets:

```bash
uv run pytest tests/test_asset_manifest.py -v
```

### Verify Structure

Check that directory structure matches specification:

```bash
uv run pytest tests/test_asset_structure.py -v
```

### Verify Game Startup

Verify game initializes with available assets:

```bash
uv run python tests/test_startup.py -v
```

## References

- **Manifest:** `src/pyglet_readme/assets/manifest.yaml`
- **Git Rules:** `.gitignore`
- **Generator:** `src/pyglet_readme/sprite_generator.py`
- **Tests:** `tests/test_asset_*.py`
- **Entity System:** `specs/entity_system.md`

